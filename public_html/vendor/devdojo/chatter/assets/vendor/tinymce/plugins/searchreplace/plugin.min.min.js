!function(){function e(b){return b&&1==b.nodeType&&"false"===b.contentEditable}function d(H,G,F,E,D){function C(h,g){if(g=g||0,!h[0]){throw"findAndReplaceDOMText cannot handle zero-length matches"}var j=h.index;if(g>0){var i=h[g];if(!i){throw"Invalid capture group"}j+=h[0].indexOf(i),h[0]=i}return[j,j+h[0].length,[h[0]]]}function B(g){var h;if(3===g.nodeType){return g.data}if(u[g.nodeName]&&!v[g.nodeName]){return""}if(h="",e(g)){return"\n"}if((v[g.nodeName]||t[g.nodeName])&&(h+="\n"),g=g.firstChild){do{h+=B(g)}while(g=g.nextSibling)}return h}function A(O,N,M){var L,K,J,I,r=[],q=0,p=O,o=N.shift(),n=0;e:for(;;){if((v[p.nodeName]||t[p.nodeName]||e(p))&&q++,3===p.nodeType&&(!K&&p.length+q>=o[1]?(K=p,I=o[1]-q):L&&r.push(p),!L&&p.length+q>o[0]&&(L=p,J=o[0]-q),q+=p.length),L&&K){if(p=M({startNode:L,startNodeIndex:J,endNode:K,endNodeIndex:I,innerNodes:r,match:o[2],matchIndex:n}),q-=K.length-I,L=null,K=null,r=[],o=N.shift(),n++,!o){break}}else{if(u[p.nodeName]&&!v[p.nodeName]||!p.firstChild){if(p.nextSibling){p=p.nextSibling;continue}}else{if(!e(p)){p=p.firstChild;continue}}}for(;;){if(p.nextSibling){p=p.nextSibling;break}if(p.parentNode===O){break e}p=p.parentNode}}}function z(h){var g;if("function"!=typeof h){var i=h.nodeType?h:w.createElement(h);g=function(j,c){var k=i.cloneNode(!1);return k.setAttribute("data-mce-index",c),j&&k.appendChild(w.createTextNode(j)),k}}else{g=h}return function(V){var U,T,S,R=V.startNode,Q=V.endNode,P=V.matchIndex;if(R===Q){var O=R;S=O.parentNode,V.startNodeIndex>0&&(U=w.createTextNode(O.data.substring(0,V.startNodeIndex)),S.insertBefore(U,O));var N=g(V.match[0],P);return S.insertBefore(N,O),V.endNodeIndex<O.length&&(T=w.createTextNode(O.data.substring(V.endNodeIndex)),S.insertBefore(T,O)),O.parentNode.removeChild(O),N}U=w.createTextNode(R.data.substring(0,V.startNodeIndex)),T=w.createTextNode(Q.data.substring(V.endNodeIndex));for(var M=g(R.data.substring(V.startNodeIndex),P),L=[],K=0,J=V.innerNodes.length;J>K;++K){var I=V.innerNodes[K],m=g(I.data,P);I.parentNode.replaceChild(m,I),L.push(m)}var b=g(Q.data.substring(0,V.endNodeIndex),P);return S=R.parentNode,S.insertBefore(U,R),S.insertBefore(M,R),S.removeChild(R),S=Q.parentNode,S.insertBefore(b,Q),S.insertBefore(T,Q),S.removeChild(Q),b}}var y,x,w,v,u,t,s=[],a=0;if(w=G.ownerDocument,v=D.getBlockElements(),u=D.getWhiteSpaceElements(),t=D.getShortEndedElements(),x=B(G)){if(H.global){for(;y=H.exec(x);){s.push(C(y,E))}}else{y=x.match(H),s.push(C(y,E))}return s.length&&(a=s.length,A(G,s,z(F))),a}}function f(v){function u(){function a(){g.statusbar.find("#next").disabled(!q(b+1).length),g.statusbar.find("#prev").disabled(!q(b-1).length)}function j(){v.windowManager.alert("Could not find the specified string.",function(){g.find("#find")[0].focus()})}var i,h={};i=tinymce.trim(v.selection.getContent({format:"text"}));var g=v.windowManager.open({layout:"flex",pack:"center",align:"center",onClose:function(){v.focus(),m.done()},onSubmit:function(c){var x,w,l,k;return c.preventDefault(),w=g.find("#case").checked(),k=g.find("#words").checked(),l=g.find("#find").value(),l.length?h.text==l&&h.caseState==w&&h.wholeWord==k?0===q(b+1).length?void j():(m.next(),void a()):(x=m.find(l,w,k),x||j(),g.statusbar.items().slice(1).disabled(0===x),a(),void (h={text:l,caseState:w,wholeWord:k})):(m.done(!1),void g.statusbar.items().slice(1).disabled(!0))},buttons:[{text:"Find",subtype:"primary",onclick:function(){g.submit()}},{text:"Replace",disabled:!0,onclick:function(){m.replace(g.find("#replace").value())||(g.statusbar.items().slice(1).disabled(!0),b=-1,h={})}},{text:"Replace all",disabled:!0,onclick:function(){m.replace(g.find("#replace").value(),!0,!0),g.statusbar.items().slice(1).disabled(!0),h={}}},{type:"spacer",flex:1},{text:"Prev",name:"prev",disabled:!0,onclick:function(){m.prev(),a()}},{text:"Next",name:"next",disabled:!0,onclick:function(){m.next(),a()}}],title:"Find and replace",items:{type:"form",padding:20,labelGap:30,spacing:10,items:[{type:"textbox",name:"find",size:40,label:"Find",value:i},{type:"textbox",name:"replace",size:40,label:"Replace with"},{type:"checkbox",name:"case",text:"Match case",label:" "},{type:"checkbox",name:"words",text:"Whole words",label:" "}]}})}function t(g){var c=g.getAttribute("data-mce-index");return"number"==typeof c?""+c:c}function s(h){var g,a;return a=v.dom.create("span",{"data-mce-bogus":1}),a.className="mce-match-marker",g=v.getBody(),m.done(!1),d(h,g,a,!1,v.schema)}function r(g){var c=g.parentNode;g.firstChild&&c.insertBefore(g.firstChild,g),g.parentNode.removeChild(g)}function q(a){var k,j=[];if(k=tinymce.toArray(v.getBody().getElementsByTagName("span")),k.length){for(var i=0;i<k.length;i++){var h=t(k[i]);null!==h&&h.length&&h===a.toString()&&j.push(k[i])}}return j}function p(a){var i=b,h=v.dom;a=a!==!1,a?i++:i--,h.removeClass(q(b),"mce-match-marker-selected");var g=q(i);return g.length?(h.addClass(q(i),"mce-match-marker-selected"),v.selection.scrollIntoView(g[0]),i):-1}function o(a){var h=v.dom,g=a.parentNode;h.remove(a),h.isEmpty(g)&&h.remove(g)}function n(g){var c=t(g);return null!==c&&c.length>0}var m=this,b=-1;m.init=function(c){c.addMenuItem("searchreplace",{text:"Find and replace",shortcut:"Meta+F",onclick:u,separator:"before",context:"edit"}),c.addButton("searchreplace",{tooltip:"Find and replace",shortcut:"Meta+F",onclick:u}),c.addCommand("SearchReplace",u),c.shortcuts.add("Meta+F","",u)},m.find=function(h,g,j){h=h.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),h=j?"\\b"+h+"\\b":h;var i=s(new RegExp(h,g?"g":"gi"));return i&&(b=-1,b=p(!0)),i},m.next=function(){var c=p(!0);-1!==c&&(b=c)},m.prev=function(){var c=p(!1);-1!==c&&(b=c)},m.replace=function(z,y,x){var w,l,k,j,i,g,a=b;for(y=y!==!1,k=v.getBody(),l=tinymce.grep(tinymce.toArray(k.getElementsByTagName("span")),n),w=0;w<l.length;w++){var A=t(l[w]);if(j=i=parseInt(A,10),x||j===b){for(z.length?(l[w].firstChild.nodeValue=z,r(l[w])):o(l[w]);l[++w];){if(j=parseInt(t(l[w]),10),j!==i){w--;break}o(l[w])}y&&a--}else{i>b&&l[w].setAttribute("data-mce-index",i-1)}}return v.undoManager.add(),b=a,y?(g=q(a+1).length>0,m.next()):(g=q(a-1).length>0,m.prev()),!x&&g},m.done=function(a){var z,y,x,w;for(y=tinymce.toArray(v.getBody().getElementsByTagName("span")),z=0;z<y.length;z++){var l=t(y[z]);null!==l&&l.length&&(l===b.toString()&&(x||(x=y[z].firstChild),w=y[z].firstChild),r(y[z]))}if(x&&w){var k=v.dom.createRng();return k.setStart(x,0),k.setEnd(w,w.data.length),a!==!1&&v.selection.setRng(k),k}}}tinymce.PluginManager.add("searchreplace",f)}();